<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<TITLE>Liens et texte en mode flot</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../fpdf.css">
</HEAD>
<BODY>
<H2>Liens et texte en mode flot</H2>
Ce tutoriel explique comment insérer des liens (internes et externes) et montre un nouveau mode
d'écriture du texte. Il contient également un parseur HTML rudimentaire.
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
&lt;?php<BR>
require('fpdf.php');<BR>
<BR>
class PDF extends FPDF<BR>
{<BR>
var $B;<BR>
var $I;<BR>
var $U;<BR>
var $HREF;<BR>
<BR>
function PDF($orientation='P',$unit='mm',$format='A4')<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Appel au constructeur parent<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;FPDF($orientation,$unit,$format);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Initialisation<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;B=0;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;I=0;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;U=0;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;HREF='';<BR>
}<BR>
<BR>
function WriteHTML($html)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Parseur HTML<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$html=str_replace(&quot;\n&quot;,' ',$html);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$a=preg_split('/&lt;(.*)&gt;/U',$html,-1,PREG_SPLIT_DELIM_CAPTURE);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;foreach($a as $i=&gt;$e)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($i%2==0)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Texte<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;HREF)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;PutLink($this-&gt;HREF,$e);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;Write(5,$e);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Balise<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($e{0}=='/')<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;CloseTag(strtoupper(substr($e,1)));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Extraction des propri&eacute;t&eacute;s<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$a2=split(' ',$e);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tag=strtoupper(array_shift($a2));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$prop=array();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach($a2 as $v)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ereg('^([^=]*)=[&quot;\']?([^&quot;\']*)[&quot;\']?$',$v,$a3))<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$prop[strtoupper($a3[1])]=$a3[2];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;OpenTag($tag,$prop);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
function OpenTag($tag,$prop)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Balise ouvrante<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if($tag=='B' or $tag=='I' or $tag=='U')<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetStyle($tag,true);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if($tag=='A')<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;HREF=$prop['HREF'];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if($tag=='BR')<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;Ln(5);<BR>
}<BR>
<BR>
function CloseTag($tag)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Balise fermante<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if($tag=='B' or $tag=='I' or $tag=='U')<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetStyle($tag,false);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;if($tag=='A')<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;HREF='';<BR>
}<BR>
<BR>
function SetStyle($tag,$enable)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Modifie le style et s&eacute;lectionne la police correspondante<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;$tag+=($enable ? 1 : -1);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$style='';<BR>
&nbsp;&nbsp;&nbsp;&nbsp;foreach(array('B','I','U') as $s)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($this-&gt;$s&gt;0)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$style.=$s;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetFont('',$style);<BR>
}<BR>
<BR>
function PutLink($URL,$txt)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;//Place un hyperlien<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetTextColor(0,0,255);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetStyle('U',true);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;Write(5,$txt,$URL);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetStyle('U',false);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;SetTextColor(0);<BR>
}<BR>
}<BR>
<BR>
$html='Vous pouvez maintenant imprimer facilement du texte m&eacute;langeant<BR>
diff&eacute;rents styles : &lt;B&gt;gras&lt;/B&gt;, &lt;I&gt;italique&lt;/I&gt;, &lt;U&gt;soulign&eacute;&lt;/U&gt;, ou<BR>
&lt;B&gt;&lt;I&gt;&lt;U&gt;tous &agrave; la fois&lt;/U&gt;&lt;/I&gt;&lt;/B&gt; !&lt;BR&gt;Vous pouvez aussi ins&eacute;rer des<BR>
liens sous forme textuelle, comme &lt;A HREF=&quot;http://www.fpdf.org&quot;&gt;<BR>
www.fpdf.org&lt;/A&gt;, ou bien sous forme d\'image : cliquez sur le logo.';<BR>
<BR>
$pdf=new PDF();<BR>
$pdf-&gt;Open();<BR>
//Premi&egrave;re page<BR>
$pdf-&gt;AddPage();<BR>
$pdf-&gt;SetFont('Arial','',20);<BR>
$pdf-&gt;Write(5,'Pour d&eacute;couvrir les nouveaut&eacute;s de ce tutoriel, cliquez ');<BR>
$pdf-&gt;SetFont('','U');<BR>
$link=$pdf-&gt;AddLink();<BR>
$pdf-&gt;Write(5,'ici',$link);<BR>
$pdf-&gt;SetFont('');<BR>
//Seconde page<BR>
$pdf-&gt;AddPage();<BR>
$pdf-&gt;SetLink($link);<BR>
$pdf-&gt;Image('logo.png',10,10,30,0,'','http://www.fpdf.org');<BR>
$pdf-&gt;SetLeftMargin(45);<BR>
$pdf-&gt;SetFontSize(14);<BR>
$pdf-&gt;WriteHTML($html);<BR>
$pdf-&gt;Output();<BR>
?&gt;
</TT>
</TD></TR></TABLE><BR>
<SCRIPT>
<!--
if(document.location.href.indexOf('http:')==0)
{
document.write("<A HREF='tuto6.php' TARGET='_blank' CLASS='demo'>[Démo]</A><BR><BR>");
}
//-->
</SCRIPT>
La nouvelle méthode pour imprimer du texte est <A HREF='../doc/write.htm'>Write()</A>. Elle est très proche de <A HREF='../doc/multicell.htm'>MultiCell()</A>;
les différences sont les suivantes :
<UL>
<LI>La fin de ligne est au niveau de la marge droite et la ligne suivante commence à la marge gauche
<LI>La position courante se déplace juste à la fin du texte
</UL>
Elle permet donc d'écrire une portion de texte, de modifier la police, puis de reprendre à partir
de l'endroit où on était resté. Par contre on ne peut plus justifier.
<BR>
<BR>
La méthode est utilisée sur la première page pour mettre un lien pointant sur la seconde. Le
début de la phrase est écrit en style normal, puis on passe en souligné pour terminer. Le lien
est créé grâce à la méthode <A HREF='../doc/addlink.htm'>AddLink()</A>, qui renvoie l'identifiant du lien. Cet identifiant
est passé en troisième paramètre à Write(). Après avoir créé la seconde page, on utilise
<A HREF='../doc/setlink.htm'>SetLink()</A> pour faire pointer le lien sur le début de la page courante.
<BR>
<BR>
On place ensuite une image avec un lien externe dessus. Un lien externe pointe sur une URL (HTTP,
mailto...). L'URL est simplement transmise en dernier paramètre de <A HREF='../doc/image.htm'>Image()</A>.
A noter que les liens externes ne fonctionnent pas lorsque le PDF est affiché dans le plug-in
de Netscape.
<BR>
<BR>
Enfin, la marge gauche est déplacée après l'image grâce à <A HREF='../doc/setleftmargin.htm'>SetLeftMargin()</A> et du texte au
format HTML est imprimé. Un parseur HTML est utilisé pour cela, reposant sur la fonction
de découpage avec expression régulière preg_split() et l'option PREG_SPLIT_DELIM_CAPTURE
(introduite en PHP 4.0.5) qui permet de récupérer les séparateurs (c'est-à-dire ici les balises).
Si vous utilisez une version antérieure, remplacez la ligne par celle-ci :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
$a=preg_split('/[&lt;&gt;]/',$html);
</TT>
</TD></TR></TABLE><BR>
qui est moins rigoureuse mais donne les mêmes résultats avec de l'HTML bien formé.
<BR>
Les balises reconnues sont &lt;B&gt;, &lt;I&gt;, &lt;U&gt;, &lt;A&gt; et &lt;BR&gt;; les autres
sont ignorées. Le parseur utilise lui aussi la méthode Write(). Le lien externe se pose de la
même façon que l'interne (troisième paramètre de Write()). A noter que <A HREF='../doc/cell.htm'>Cell()</A> permet
également de poser des liens.
</BODY>
</HTML>
