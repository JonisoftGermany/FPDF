<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<TITLE>Ajout de polices et encodage</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../fpdf.css">
</HEAD>
<BODY>
<H2>Ajout de polices et encodage</H2>
Ce tutoriel explique comment ajouter des polices TrueType afin de ne plus se limiter aux polices
standard. L'autre intérêt est que l'on peut également choisir l'encodage des caractères afin
d'utiliser d'autres langues (les polices standard ayant trop peu de caractères disponibles).
<BR>
<BR>
Il y a deux façons d'utiliser une nouvelle police : en l'incorporant ou pas. Lorsqu'une police
n'est pas incorporée, elle est recherchée dans le système. L'avantage est que le fichier PDF est
plus léger; par contre, si elle n'est pas trouvée, une police de substitution est utilisée. Il
vaut donc mieux s'assurer que le système qui lit le PDF a bien la police installée; si le fichier
doit être largement diffusé, il est préférable d'incorporer.
<BR>
<BR>
L'ajout d'une police se fait en trois étapes :
<UL>
<LI>Génération du fichier de métrique (.afm)
<LI>Génération du fichier de définition de police (.php)
<LI>Déclaration de la police dans le script
</UL>
<H4 CLASS='st'>Génération du fichier de métrique</H4>
La première étape consiste à générer le fichier AFM. Il existe un utilitaire gratuit qui permet
de le faire : <A HREF="http://ttf2pt1.sourceforge.net" TARGET="_BLANK">ttf2pt1</A>. L'exécutable
pour Windows est disponible <A HREF="http://www.fpdf.org/fr/dl.php?id=21">ici</A>. La syntaxe à
utiliser est la suivante :
<BR>
<BR>
<TT>ttf2pt1 -a police.ttf police</TT>
<BR>
<BR>
Par exemple, pour la police Comic Sans MS Normal :
<BR>
<BR>
<TT>ttf2pt1 -a c:\windows\fonts\comic.ttf comic</TT>
<BR>
<BR>
Deux fichiers sont créés; celui qui nous intéresse est comic.afm.
<H4 CLASS='st'>Génération du fichier de définition de police</H4>
La deuxième étape consiste à générer un fichier PHP contenant toutes les informations dont a
besoin FPDF; on en profite également pour compresser le fichier de police. Pour cela, un script
est fourni dans le répertoire font/makefont/ de l'archive : makefont.php. Il contient la
fonction suivante :
<BR>
<BR>
<TT>MakeFont(<B>string</B> fontfile, <B>string</B> afmfile [, <B>string</B> enc [, <B>array</B> patch]])</TT>
<BR>
<BR>
<TT><U>fontfile</U></TT>
<BLOCKQUOTE>
Chemin du fichier .ttf.
</BLOCKQUOTE>
<TT><U>afmfile</U></TT>
<BLOCKQUOTE>
Chemin du fichier .afm.
</BLOCKQUOTE>
<TT><U>enc</U></TT>
<BLOCKQUOTE>
Nom de l'encodage à utiliser. Valeur par défaut : <TT>cp1252</TT>.
</BLOCKQUOTE>
<TT><U>patch</U></TT>
<BLOCKQUOTE>
Modification de l'encodage. Vide par défaut.
</BLOCKQUOTE>
<BR>
Si vous ne voulez pas incorporer la police, passez une chaîne vide comme premier argument.
<BR>
Note : dans le cas d'une police qui porte le même nom qu'une police standard, par exemple
arial.ttf, il est obligatoire d'incorporer. Sinon, Acrobat utilisera sa propre police du même
nom.
<BR>
<BR>
Le fichier AFM est celui précédemment généré.
<BR>
<BR>
L'encodage définit l'association entre un code (compris entre 0 et 255) et un caractère. Les 128
premières sont fixes et correspondent à l'ASCII; les suivantes sont variables. Les encodages sont
stockés dans des fichiers .map. Ceux disponibles sont les suivants :
<UL>
<LI>cp1250 (Europe Centrale)
<LI>cp1251 (cyrillique)
<LI>cp1252 (Europe de l'Ouest)
<LI>cp1253 (grec)
<LI>ISO-8859-1 (Europe de l'Ouest)
<LI>ISO-8859-2 (Europe Centrale)
<LI>ISO-8859-5 (cyrillique)
<LI>ISO-8859-7 (grec)
<LI>ISO-8859-15 (Europe de l'Ouest)
<LI>ISO-8859-16 (Europe Centrale)
<LI>KOI8-R (cyrillique)
</UL>
Il faut bien sûr que la police contienne les caractères correspondant à l'encodage choisi.
<BR>
Dans le cas particulier d'une police symbolique (c'est-à-dire qui ne contient pas de lettres,
comme Symbol et ZapfDingbats), il faut passer une chaîne vide.
<BR>
Les encodages commençant par cp sont ceux utilisés par Windows; les systèmes Linux utilisent
généralement les ISO.
<BR>
Remarque : les polices standard utilisent cp1252.
<BR>
<BR>
Le dernier paramètre permet d'apporter des modifications à l'encodage. Il peut en effet arriver
que l'on souhaite ajouter des caractères. Par exemple, l'encodage ISO-8859-1 ne comporte pas
le symbole euro. Pour l'ajouter en position 164, il faut passer <TT>array(164=>'Euro')</TT>.
<BR>
<BR>
Après avoir appelé la fonction (créez pour cela un nouveau fichier et incluez makefont.php, ou
bien ajoutez l'appel directement dedans), un fichier .php est créé, avec comme nom celui du
fichier AFM. Vous pouvez le renommer si vous le souhaitez. Dans le cas de l'incorporation, le
fichier de police est compressé et donne un second fichier avec comme extension .z (sauf si la
fonction de compression n'est pas disponible, elle nécessite Zlib). Vous pouvez également le
renommer, mais dans ce cas vous devez modifier la variable <TT>$file</TT> dans le fichier .php.
<BR>
<BR>
Exemple :
<BR>
<BR>
<TT>MakeFont('c:\\windows\\fonts\\comic.ttf','comic.afm','cp1252');</TT>
<BR>
<BR>
Ce qui donne les fichiers comic.php et comic.z.
<BR>
<BR>
Vous devez ensuite copier le ou les fichiers générés soit dans le répertoire du script qui va
utiliser la nouvelle police, soit dans le répertoire donné par FPDF_FONTPATH si la constante est
définie. Si la police n'a pu être compressée, il faut copier le .ttf à la place du .z.
<H4 CLASS='st'>Déclaration de la police dans le script</H4>
Cette dernière étape est la plus simple. Il suffit d'appeler la méthode <A HREF='../doc/addfont.htm'>AddFont()</A>. Par
exemple :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
$pdf-&gt;AddFont('Comic','','comic.php');
</TT>
</TD></TR></TABLE><BR>
ou tout simplement :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
$pdf-&gt;AddFont('Comic');
</TT>
</TD></TR></TABLE><BR>
Et la police est maintenant disponible (dans le style normal ou souligné), utilisable comme les
autres. Si on avait traité le Comic Sans MS Gras (comicbd.ttf), on aurait mis :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
$pdf-&gt;AddFont('Comic','B','comicbd.php');
</TT>
</TD></TR></TABLE><BR>
<H4 CLASS='st'>Exemple</H4>
Voyons maintenant un petit exemple complet. La police utilisée est Calligrapher, disponible sur
<A HREF="http://www.abstractfonts.com/fonts/" TARGET="_blank">www.abstractfonts.com</A> (un site proposant de
nombreuses polices TrueType gratuites). La première étape est la génération du fichier AFM :
<BR>
<BR>
<TT>ttf2pt1 -a calligra.ttf calligra</TT>
<BR>
<BR>
ce qui donne calligra.afm (et calligra.t1a qu'on peut effacer). Générons ensuite le fichier de
définition :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
&lt;?php<BR>
require('../font/makefont/makefont.php');<BR>
<BR>
MakeFont('calligra.ttf','calligra.afm');<BR>
?&gt;
</TT>
</TD></TR></TABLE><BR>
L'exécution de la fonction donne lieu au compte-rendu suivant :
<BR>
<BR>
<B>Warning:</B> character Euro is missing<BR>
<B>Warning:</B> character Zcaron is missing<BR>
<B>Warning:</B> character zcaron is missing<BR>
<B>Warning:</B> character eth is missing<BR>
Font file compressed (calligra.z)<BR>
Font definition file generated (calligra.php)<BR>
<BR>
Le caractère euro n'est pas présent dans la police (elle est trop ancienne). Trois autres
caractères sont également absents, mais ils ne nous intéressent pas.
<BR>
Nous pouvons maintenant copier les deux fichiers dans le répertoire des polices, ou bien les
mettre dans le même répertoire que notre script :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
&lt;?php<BR>
require('fpdf.php');<BR>
<BR>
$pdf=new FPDF();<BR>
$pdf-&gt;Open();<BR>
$pdf-&gt;AddPage();<BR>
$pdf-&gt;AddFont('Calligrapher','','calligra.php');<BR>
$pdf-&gt;SetFont('Calligrapher','',35);<BR>
$pdf-&gt;Cell(0,10,'Changez de police avec FPDF !');<BR>
$pdf-&gt;Output();<BR>
?&gt;
</TT>
</TD></TR></TABLE><BR>
<SCRIPT>
<!--
if(document.location.href.indexOf('http:')==0)
{
document.write("<A HREF='tuto7.php' TARGET='_blank' CLASS='demo'>[Démo]</A><BR><BR>");
}
//-->
</SCRIPT>
<B>Note:</B> un bug affecte le plug-in Acrobat 5 sous IE et la nouvelle police n'apparaît pas
immédiatement (une police de substitution est utilisée). Il faut provoquer un rafraîchissement
de la fenêtre (par un redimensionnement, defilement ou basculement) pour la faire apparaître.
<H4 CLASS='st'>A propos du symbole euro</H4>
Le caractère euro n'est pas présent dans tous les encodages, et n'est pas toujours situé à la
même position :
<BR>
<BR>
<TABLE BORDER="2" CELLSPACING="0" CELLPADDING="2" BGCOLOR="#FFFFEE">
<TR><TD>cp1250</TD><TD>128<BR></TD></TR>
<TR><TD>cp1251</TD><TD>136<BR></TD></TR>
<TR><TD>cp1252</TD><TD>128<BR></TD></TR>
<TR><TD>cp1253</TD><TD>128<BR></TD></TR>
<TR><TD>ISO-8859-1</TD><TD>absent&nbsp;<BR></TD></TR>
<TR><TD>ISO-8859-2</TD><TD>absent&nbsp;<BR></TD></TR>
<TR><TD>ISO-8859-5</TD><TD>absent&nbsp;<BR></TD></TR>
<TR><TD>ISO-8859-7</TD><TD>absent&nbsp;<BR></TD></TR>
<TR><TD>ISO-8859-15&nbsp;</TD><TD>164<BR></TD></TR>
<TR><TD>ISO-8859-16&nbsp;</TD><TD>164<BR></TD></TR>
<TR><TD>KOI8-R</TD><TD>absent&nbsp;<BR></TD></TR>
</TABLE>
<BR>
ISO-8859-1 est très répandu mais ne comporte pas l'euro. Si vous en avez besoin, le plus simple
consiste à prendre à la place cp1252 ou ISO-8859-15, qui sont pratiquement identiques mais
disposent du précieux caractère.
<BR>
Pour ISO-8859-2, il est possible de prendre à la place ISO-8859-16, mais ce dernier est récent et
présente de nombreuses différences. Le plus simple consiste à patcher l'encodage pour ajouter
l'euro, comme expliqué plus haut. Même chose pour ISO-8859-5, ISO-8859-7 et KOI-R.
<H4 CLASS='st'>Synthèse de police sous Windows</H4>
Lorsqu'une police n'est pas disponible dans un style donné, Windows est capable de la synthétiser
à partir de la version normale. Par exemple, il n'y a pas de police Comic Sans MS Italique, mais
elle peut être fabriquée à partir de Comic Sans MS Normal. Ceci peut être exploité dans un PDF,
mais nécessite malheureusement que la police normale soit présente dans le système (l'incorporer
ne fonctionne pas). La marche à suivre est la suivante :
<UL>
<LI>Générez le fichier de définition pour la police normale sans incorporation (et renommez-le
éventuellement pour refléter le style désiré)
<LI>Ouvrez-le et ajoutez à la variable <TT>$name</TT> une virgule suivie du style (<TT>Italic</TT>,
<TT>Bold</TT> ou <TT>BoldItalic</TT>)
</UL>
Par exemple, pour le fichier comici.php :
<BR>
<BR>
<TT>$name='ComicSansMS,Italic';<BR>
<BR>
On l'utilise ensuite normalement :
<BR>
<BR>
<TABLE WIDTH="100%" BGCOLOR="#E0E0E0"><TR><TD>
<TT>
$pdf-&gt;AddFont('Comic','I','comici.php');
</TT>
</TD></TR></TABLE><BR>

</BODY>
</HTML>
